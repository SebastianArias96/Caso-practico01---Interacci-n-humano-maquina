<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gesti贸n de Contactos - UTE</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <header>
        <h1>Gesti贸n de Contactos</h1>
        <nav>
            <ul>
                <li><a href="index.html">Inicio</a></li>
                <li><a href="eventos.html">Eventos</a></li>
                <li><a href="contactos.html">Contactos</a></li>
                <li><a href="ubicacion.html">Ubicaciones</a></li>
            </ul>
        </nav>
    </header>
    <main>
        <h2>Agregar Nuevo Contacto</h2>
        <form id="form-contactos">
            <div>
                <label for="nombre">Nombres y Apellidos:</label>
                <input type="text" id="nombre" placeholder="Ej: Dr. Juan P茅rez" required>
            </div>
            
            <div>
                <label for="cedula">C茅dula de Identidad:</label>
                <input type="text" id="cedula" placeholder="Ej: 1234567890" required>
            </div>

            <div>
                <label for="profesion">Profesi贸n:</label>
                <input type="text" id="profesion" placeholder="Ej: Ingeniero, Docente" required>
            </div>
            
            <div>
                <label for="email">Correo Electr贸nico:</label>
                <input type="email" id="email" placeholder="ejemplo@ute.edu.ec" required>
            </div>
            
            <div>
                <label for="telefono">N煤mero de Tel茅fono:</label>
                <input type="tel" id="telefono" placeholder="0999999999" required>
            </div>
            
            <button type="submit">Guardar Contacto en Firebase</button>
        </form>
        
        <hr>
        
        <h2>Contactos Registrados (Nube)</h2>
        <ul id="lista-contactos">
            </ul>
    </main>
    <footer>
        <p>&copy; 2025 Universidad Tecnol贸gica Equinoccial</p>
    </footer>

    <script type="module">
        import { initializeApp } from "firebase/app";
        import { getFirestore, collection, addDoc, getDocs, serverTimestamp } from "firebase/firestore";

        const firebaseConfig = {
            apiKey: "AIzaSyDxKQWalmHfLxhbYGru_hzvfuVCUJuHuzw",
            authDomain: "caso-practico-c631b.firebaseapp.com",
            projectId: "caso-practico-c631b",
            storageBucket: "caso-practico-c631b.firebasestorage.app",
            messagingSenderId: "233285378258",
            appId: "1:233285378258:web:8abcd2c3ae504e17da8d0b"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const form = document.getElementById('form-contactos');
        const listaUl = document.getElementById('lista-contactos');

        // 1. Guardar Contacto
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const nuevoContacto = {
                nombre: document.getElementById('nombre').value,
                cedula: document.getElementById('cedula').value,
                profesion: document.getElementById('profesion').value,
                email: document.getElementById('email').value,
                telefono: document.getElementById('telefono').value,
                fecha_registro: serverTimestamp()
            };

            try {
                await addDoc(collection(db, "contactos"), nuevoContacto);
                alert(" Contacto guardado correctamente en la nube.");
                form.reset();
                cargarContactos();
            } catch (error) {
                console.error("Error al guardar contacto:", error);
                alert("Error al conectar con la base de datos.");
            }
        });

        // 2. Leer Contactos
        async function cargarContactos() {
            listaUl.innerHTML = "Cargando lista...";
            const querySnapshot = await getDocs(collection(db, "contactos"));
            listaUl.innerHTML = "";
            
            querySnapshot.forEach((doc) => {
                const data = doc.data();
                const li = document.createElement('li');
                li.style.padding = "10px";
                li.style.borderBottom = "1px solid #eee";
                li.innerHTML = `
                    <strong>${data.nombre}</strong> (${data.profesion})<br>
                     ${data.email} |  ${data.telefono}
                `;
                listaUl.appendChild(li);
            });
        }

        // Cargar al iniciar
        cargarContactos();
    </script>
</body>
</html>
