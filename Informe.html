<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Informe de Gesti√≥n - UTE</title>
    <link rel="stylesheet" href="css/styles.css">
    <style>
        /* Estilos de impresi√≥n y visualizaci√≥n */
        @media print {
            header nav, .no-print { display: none !important; }
            body { background: white !important; }
            main { box-shadow: none !important; max-width: 100% !important; }
            .print-header { display: block !important; text-align: center; border-bottom: 3px solid #2563eb; }
        }
        .print-header { display: none; }
        .summary-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin: 2rem 0; }
        .stat-card { background: #f8fafc; padding: 1.5rem; border-radius: 0.75rem; text-align: center; border-left: 5px solid #2563eb; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .stat-card .number { font-size: 2.5rem; font-weight: bold; color: #2563eb; }
        .data-card { background: white; padding: 1rem; margin-bottom: 1rem; border-radius: 0.5rem; border: 1px solid #e2e8f0; }
    </style>
</head>
<body>
    <header>
        <h1>üìä Panel de Informes UTE</h1>
        <nav>
            <ul>
                <li><a href="index.html">Inicio</a></li>
                <li><a href="eventos.html">Eventos</a></li>
                <li><a href="contactos.html">Contactos</a></li>
                <li><a href="ubicacion.html">Ubicaciones</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <div class="print-header">
            <h1>REPORTE OFICIAL DE GESTI√ìN</h1>
            <p>Universidad Tecnol√≥gica Equinoccial</p>
            <p>Fecha: <span id="fecha-actual"></span></p>
        </div>

        <div class="action-buttons no-print" style="text-align: center; margin-top: 20px;">
            <button onclick="window.print()" style="padding: 10px 20px; background: #2563eb; color: white; border: none; border-radius: 5px; cursor: pointer;">
                üñ®Ô∏è Imprimir / Guardar PDF
            </button>
        </div>

        <div class="summary-stats">
            <div class="stat-card">
                <h3>Eventos</h3>
                <div class="number" id="count-eventos">0</div>
            </div>
            <div class="stat-card" style="border-left-color: #10b981;">
                <h3>Contactos</h3>
                <div class="number" id="count-contactos">0</div>
            </div>
            <div class="stat-card" style="border-left-color: #f59e0b;">
                <h3>Ubicaciones</h3>
                <div class="number" id="count-ubicaciones">0</div>
            </div>
        </div>

        <section>
            <h2>üìÖ Resumen de Actividades</h2>
            <div id="reporte-contenido">Cargando datos globales de Firebase...</div>
        </section>
    </main>

    <script type="module">
        import { initializeApp } from "firebase/app";
        import { getFirestore, collection, getDocs } from "firebase/firestore";

        const firebaseConfig = {
            apiKey: "AIzaSyDxKQWalmHfLxhbYGru_hzvfuVCUJuHuzw",
            authDomain: "caso-practico-c631b.firebaseapp.com",
            projectId: "caso-practico-c631b",
            storageBucket: "caso-practico-c631b.firebasestorage.app",
            messagingSenderId: "233285378258",
            appId: "1:233285378258:web:8abcd2c3ae504e17da8d0b"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        async function generarInforme() {
            const contenedor = document.getElementById('reporte-contenido');
            contenedor.innerHTML = "";

            try {
                // 1. Obtener Eventos
                const snapEventos = await getDocs(collection(db, "eventos"));
                document.getElementById('count-eventos').innerText = snapEventos.size;

                // 2. Obtener Contactos
                const snapContactos = await getDocs(collection(db, "contactos"));
                document.getElementById('count-contactos').innerText = snapContactos.size;

                // 3. Obtener Ubicaciones
                const snapUbicaciones = await getDocs(collection(db, "ubicaciones"));
                document.getElementById('count-ubicaciones').innerText = snapUbicaciones.size;

                // Renderizar una vista previa combinada
                let html = "<h3>√öltimos Registros Detectados:</h3>";
                
                snapEventos.forEach(doc => {
                    const d = doc.data();
                    html += <div class="data-card"><strong>EVENTO:</strong> ${d.titulo} - üìÖ ${d.fecha_hora}</div>;
                });

                snapContactos.forEach(doc => {
                    const d = doc.data();
                    html += <div class="data-card" style="border-left: 4px solid #10b981;"><strong>CONTACTO:</strong> ${d.nombre} (${d.profesion})</div>;
                });

                contenedor.innerHTML = html;

            } catch (error) {
                console.error(error);
                contenedor.innerHTML = "Error al cargar el informe.";
            }
        }

        document.getElementById('fecha-actual').innerText = new Date().toLocaleDateString();
        generarInforme();
    </script>
</body>
</html>
